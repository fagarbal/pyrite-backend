<doctype html>
<html>
<head>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
	'use strict';

	
	class PyriteServer {
		constructor(socket, url) {
			this.socket = url ? socket.connect(url) : socket();

			return this.get();
		}

		__handleMethod(controller, method) {
			return (...args) => {
				return new Promise((resolve) => {
					this.socket.on(controller + '.' + method + ':' + args, resolve);
					this.socket.emit(controller + '.' + method, controller, method, ...args);
				});
			};
		}

		get() {
			return new Promise((resolve) => {
				this.socket.on('controllersAllow', (controllers) => {
					for (let controller in controllers) {
						this[controller] = {};

						for (let method of controllers[controller]) {
							const callback = this.__handleMethod(controller, method);

							this[controller][method] = callback.bind(this[controller]);
						}

					}
					resolve(this);
				});
			});
		}
	}


	var piriteServer = new PyriteServer(io);

	piriteServer.then((server) => {
		server.example.getNumbers().then((data) => {
			console.log(data)
		});

		server.example.sum(1,2).then((data) => {
			console.log(data)
		});

		server.example.sum(8,7).then((data) => {
			console.log(data)
		});

		server.example.formatName('Fabio','Garcia', 'Balbuena').then((data) => {
			console.log(data)
		});

		server.example.formatName('Pepe','Hola', 'Where').then((data) => {
			console.log(data)
		});

		server.asturias.getCities().then((data) => {
			console.log(data)
		});

		server.berlin.getCities().then((data) => {
			console.log(data)
		});

		server.example.setNumbers([4,5,6]);
	});


</script>
</head>
<body>
	
</body>
</html>