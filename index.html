<doctype html>
<html>
<head>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
	'use strict';

	class PyriteServer {
		constructor(socket, sync) {
			this.socket = socket();

			return this.get();
		}

		get() {
			return new Promise((resolve) => {
				this.socket.on('controllersAllow', (controllers) => {
					console.log(controllers);

					for (let controller in controllers) {
						this[controller] = {};

						for (let method of controllers[controller]) {
							const callback = (...args) => {
								return new Promise((resolve) => {
									this.socket.on(controller + '.' + method + ':' + args, resolve);
									this.socket.emit(controller + '.' + method, controller, method, ...args);
								});
							};

							this[controller][method] = callback.bind(this[controller]);
						}

					}
					resolve(this);
				});
			});
		}
	}

	var piriteServer = new PyriteServer(io);

	var piriteMethods = null;

	piriteServer.then((server) => {
		server.example.getNumbers().then((data) => {
			console.log(data)
		});

		server.example.sum(1,2).then((data) => {
			console.log(data)
		});

		server.example.sum(8,7).then((data) => {
			console.log(data)
		});

		server.example.formatName('Fabio','Garcia', 'Balbuena').then((data) => {
			console.log(data)
		});

		server.example.formatName('Pepe','Hola', 'Where').then((data) => {
			console.log(data)
		});

		server.asturias.getCities().then((data) => {
			console.log(data)
		});

		server.berlin.getCities().then((data) => {
			console.log(data)
		});

		server.example.setNumbers([4,5,6]);

		piriteMethods = server;
	});


</script>
</head>
<body>
	
</body>
</html>