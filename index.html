<doctype html>
<html>
<head>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
	'use strict';
	const Server = {
		run : (socket) => {
			this.socket = socket();

			return new Promise((resolve) => {
				this.socket.on('controllersAllow', (controllers) => {
					for (let controller in controllers) {
						this[controller] = {};

						for (let method of controllers[controller]) {
							const callback = (...args) => {
								return new Promise((resolve) => {
									this.socket.on(controller + '.' + method + ':' + args, resolve);
									this.socket.emit(controller + '.' + method, controller, method, ...args);
								});
							};

							this[controller][method] = callback.bind(this);
						}

					}
					resolve(this);
				});
			});
		}
	};

	Server.run(io).then((server) => {
		server.example.getNumbers().then((data) => {
			console.log(data)
		});
		server.example.sum(1,2).then((data) => {
			console.log(data)
		});

		server.example.sum(8,7).then((data) => {
			console.log(data)
		});

		server.example.formatName('Fabio','Garcia', 'Balbuena').then((data) => {
			console.log(data)
		});

		server.example.formatName('Pepe','Hola', 'Where').then((data) => {
			console.log(data)
		});
	});


</script>
</head>
<body>
	
</body>
</html>